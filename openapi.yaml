openapi: 3.0.0
info:
  version: 1.1.2
  title: Integrador Repasse
  termsOfService: 'https://repasses.com.br/terms/'
  contact:
    email: suporte@repasses.com.br
    url: 'https://repasses.com.br'
  x-logo:
    url: 'https://www.repasses.com.br/wp-content/themes/2018_repasse_site/assets/images/logo-repasse-white.png'
    backgroundColor: '#2B4F83'
  description: |

    Esta é a API para visualização / cadastro de anúncios da plataforma Repasse
    # Introdução
    Esta especificação visa auxiliar programadores a integrarem seus sistemas com a plataforma Repasse.
    ## Ambientes
    Oferecemos o ambiente de testes para envio de anúncios até a homologação, o endereço da api está em https://dev.aplicativorepasse.com.br. O ambiente de produção (apenas para clientes homologados está em https://srv.aplicativorepasse.com.br)
    Para obter uma credencial de testes e de produção contate o nosso departamento comercial.
    ## Autenticação:
    Após obter sua credencial você deve informá-la em suas requisições  via Header usando a o cabeçalho com o nome Api-Key. A chave de autenticação serve para os endpoints de cadastro de anúncio. Os endpoints do site de cliente, são liberados via departamento comercial e não  precisam de chave de autenticação.

    ## Jornada do anúncio
    Siga estes passos para publicar um novo anúncio:
    1. Obtenha a lista auxiliar (marcas/modelos/anos/opcionais/vendedores) em [/store_site/{store_id}/populate/type/{car_type}](#operation/populateCar)
    1. Com a marca e o ano desejado obtenha a fipe do anúncio em [/store_site/{store_id}/populate/model/{brand_id}/{year}](#operation/populateModels)
    1. Com os dados das listas auxiliares envie o cadastro do anúncio em [/store_site/{store_id}/car](#operation/createCar)
    1. Envie entre 4 e 10 fotos em [/store_site/{store_id}/car/{car_id}/image](#operation/saveCarPhoto)
    1. Solicite a publicação do anúncio em [/store_site/{store_id}/car/{car_id}/publish](#operation/publishCar)
tags:
  - name: Auxiliares
    description: Endpoints para obtenção de dados auxiliares ao cadastro de anúncios
  - name: Cadastro
    description: Operações referentes ao cadastro e edição de anúncios
  - name: Site
    description: Endpoints do site de cliente (que não usam token de autenticação)
  - name: Avaliações
    description: Endpoints do avaliador de veículos Repasse
servers:
  - url: 'https://dev.aplicativorepasse.com.br/api'
  - url: 'https://srv.aplicativorepasse.com.br/api'
paths:
  '/store_site/{store_id}/car':
    parameters:
      - name: store_id
        in: path
        description: Código da loja
        required: true
        schema:
          type: integer
    post:
      tags:
        - Cadastro
      summary: Cria um novo Carro
      description: Novos carros são criados por este endpoint
      operationId: createCar
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Car'
        required: true
      security:
        - api_key: []
      responses:
        '200':
          description: Carro cadastrado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  car_id:
                    type: integer
                    description: ID do carro (anúncio)
                  msg:
                    type: string
                    description: Mensagem informativa
              example:
                car_id: 515
                msg: Anúncio cadastrado com sucesso
        '400':
          description: Um dos campos obrigatórios não foi preenchido
    get:
      tags:
        - Site
      summary: Obtem um carro
      description: Obtem um carro pelo ID
      operationId: getCar
      parameters:
        - name: store_id
          in: path
          description: Código da loja
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Anúncio
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Resultado da requisição
                  data:
                    $ref: '#/components/schemas/CarResponse'
  '/store_site/{store_id}/car/{car_id}':
    parameters:
      - name: store_id
        in: path
        description: Código da loja
        required: true
        schema:
          type: integer
      - name: car_id
        in: path
        description: Código da carro
        required: true
        schema:
          type: integer
    put:
      tags:
        - Cadastro
      summary: Edita carro já publicado
      description: Edição de carro
      operationId: editCar
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EditCar'
        required: true
      security:
        - api_key: []
      responses:
        '200':
          description: Carro editado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  car_id:
                    type: integer
                    description: ID do carro (anúncio)
                  msg:
                    type: string
                    description: Mensagem informativa
              example:
                car_id: 515
                msg: Anúncio cadastrado com sucesso
        '400':
          description: Um dos campos obrigatórios não foi preenchido
  '/store_site/{store_id}/car/{car_id}/image':
    post:
      tags:
        - Cadastro
      summary: Envia uma imagem referente a um carro
      operationId: saveCarPhoto
      parameters:
        - name: store_id
          in: path
          description: Código da loja
          required: true
          schema:
            type: integer
        - name: car_id
          in: path
          required: true
          schema:
            type: integer
          description: Id do carro
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                filename:
                  type: string
                  format: binary
              required:
                - filename
      security:
        - api_key: []
      responses:
        '200':
          description: Imagem enviada com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: resultado da operação (true or false)
                  data:
                    type: object
                    description: Dados da operação
                    properties:
                      id:
                        type: integer
                        description: Id da imagem enviada
                      filename:
                        type: string
                        description: Nome do arquivo thumbnail para ser usado no frontend
              example:
                success: true
                data:
                  id: 10
                  filename: 23103210321321.png
        '400':
          description: 'Bad request, falta algum campo obrigatório'
        '404':
          description: Anúncio não existe
  '/store_site/{store_id}/car/{car_id}/image/{image_id}':
    delete:
      tags:
        - Cadastro
      summary: Remove a imagem do carro
      operationId: removeImage
      parameters:
        - name: store_id
          in: path
          description: Código da loja
          required: true
          schema:
            type: integer
        - name: car_id
          in: path
          required: true
          schema:
            type: integer
          description: Id do carro
        - name: image_id
          in: path
          required: true
          schema:
            type: integer
          description: Id da imagem
      security:
        - api_key: []
      responses:
        '200':
          description: Imagem removida com sucesso
        '404':
          description: Imagem não encontrada
        '422':
          description: Um dos parâmetros (loja/carro/imagem) não foi informado
  '/store_site/{store_id}/car/{car_id}/publish':
    post:
      tags:
        - Cadastro
      summary: Publica o carro na plataforma
      description: 'Envia o carro para publicação na plataforma ele vai ser moderado pelo nosso sistema e, caso liberado, estará apto a receber negociações e propostas'
      operationId: publishCar
      parameters:
        - name: store_id
          in: path
          description: Código da loja
          required: true
          schema:
            type: integer
        - name: car_id
          in: path
          required: true
          schema:
            type: integer
          description: Id do anúncio
      security:
        - api_key: []
      responses:
        '201':
          description: 'Enviado com sucesso, o resultado (em análise/publicado/exclusivo) vem no corpo deste resultado'
        '409':
          description: A quantidade de fotos obrigatórias (atualmente entre 4 e 10) está incorreta
        '422':
          description: Falta um parâmetro obrigatório (loja/carro)
  '/store_site/{store_id}/car/{car_id}/remove':
    parameters:
      - name: store_id
        in: path
        description: Código da loja
        required: true
        schema:
          type: integer
      - name: car_id
        in: path
        description: Código da carro
        required: true
        schema:
          type: integer
    post:
      tags:
        - Cadastro
      summary: Solicita a remoção de um carro da plataforma
      description: 'Permite encerrar a venda de um carro, tanto removendo como marcando como vendido'
      operationId: removeCar
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RemoveCar'
        required: true
      security:
        - api_key: []
      responses:
        '200':
          description: Solicitação efetuada com sucesso
  '/store_site/{store_id}/cars':
    parameters:
      - name: store_id
        in: path
        description: Código da loja
        required: true
        schema:
          type: integer
    get:
      summary: 'Obtém a lista de veículos da loja, com paginação'
      description: 'Obtém a lista de veículos da loja, com paginação'
      tags:
        - Site
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
          description: 'Número da página (default: 1)'
        - name: car_type
          in: query
          required: false
          schema:
            type: string
          description: 'Car type (e.g. sedan, SUV, etc.)'
        - name: brand_id
          in: query
          required: false
          schema:
            type: integer
          description: Brand ID
        - name: model_id
          in: query
          required: false
          schema:
            type: integer
          description: Model ID
        - name: start_year
          in: query
          required: false
          schema:
            type: integer
          description: 'Start year (default: 1984)'
        - name: end_year
          in: query
          required: false
          schema:
            type: integer
          description: 'End year (default: current year + 1)'
        - name: fuel
          in: query
          required: false
          schema:
            type: array
            items:
              type: string
          description: 'Fuel types (e.g. gasoline, diesel, etc.)'
        - name: start_price
          in: query
          required: false
          schema:
            type: integer
          description: 'Start price (default: 0)'
        - name: end_price
          in: query
          required: false
          schema:
            type: integer
          description: 'End price (default: 999999)'
        - name: doors
          in: query
          required: false
          schema:
            type: array
            items:
              type: integer
          description: Number of doors
        - name: eixos
          in: query
          required: false
          schema:
            type: array
            items:
              type: integer
          description: Number of axles
        - name: start_km
          in: query
          required: false
          schema:
            type: integer
          description: 'Start km (default: 0)'
        - name: end_km
          in: query
          required: false
          schema:
            type: integer
          description: 'End km (default: 999999)'
        - name: state_id
          in: query
          required: false
          schema:
            type: integer
          description: State ID
        - name: color_ids
          in: query
          required: false
          schema:
            type: array
            items:
              type: integer
          description: Color IDs
        - name: optionals_id
          in: query
          required: false
          schema:
            type: array
            items:
              type: integer
          description: Optional IDs
      responses:
        '200':
          description: Carro cadastrado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Indica se a operação foi bem sucedida
                  total:
                    type: integer
                    description: Total de carros
                  order_by:
                    type: array
                    items:
                      $ref: '#/components/schemas/OrderResponse'
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/CarResponse'
  '/store_site/{store_id}/evaluations':
    parameters:
      - name: store_id
        in: path
        description: Código da loja
        required: true
        schema:
          type: integer
    get:
      tags:
        - Avaliações
      summary: Obtém uma lista de avaliações
      description: Obtém uma lista de avaliações
      operationId: getEvaluations
      security:
        - api_key: []
      parameters:
        - name: store_id
          in: path
          description: Código da loja
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Anúncio
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Resultado da requisição
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/CarEvaluation'
  '/store_site/{store_id}/populate/model/{brand_id}/{year}':
    get:
      tags:
        - Auxiliares
      summary: Obtem a lista de modelos para cadastro de anúncios
      operationId: populateModels
      parameters:
        - name: store_id
          in: path
          required: true
          description: Id do cliente
          schema:
            type: integer
        - name: brand_id
          in: path
          required: true
          description: 'Marca do veículo ( obtido em populate/{car_type} )'
          schema:
            type: integer
        - name: year
          in: path
          required: true
          description: Ano do Modelo do veículo (1984/2020) ou Zero KM
          schema:
            oneOf:
              - type: integer
              - type: string
      security:
        - api_key: []
      responses:
        '200':
          description: Dados da requisição
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: resultado da requisição
                  data:
                    type: array
                    description: Dados da tabela Fipe
                    items:
                      $ref: '#/components/schemas/Fipe'
  '/store_site/{store_id}/populate/type/{car_type}':
    get:
      tags:
        - Auxiliares
      summary: Obtem a lista inicial para cadastro de anúncios (e também para pesquisar anúncios)
      operationId: populateCar
      parameters:
        - name: store_id
          in: path
          required: true
          description: id do cliente
          schema:
            type: integer
        - name: car_type
          in: path
          required: true
          description: 'Tipo de veículo (0=carro, 5=caminhão, 8=moto)'
          schema:
            type: integer
            enum:
              - 0
              - 5
              - 8
      responses:
        '200':
          description: Dados da requisição
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Resultado da requisição
                  data:
                    type: object
                    properties:
                      brands:
                        description: Listagem de marcas
                        type: array
                        items:
                          $ref: '#/components/schemas/Brand'
                      models:
                        description: Listagem de modelos (que será utilizada para obter a fipe)
                        type: array
                        items:
                          $ref: '#/components/schemas/Modelo'
                      colors:
                        description: ID da cor (que será usado no cadastro de anúncio)
                        type: array
                        items:
                          $ref: '#/components/schemas/Color'
                      doors:
                        type: array
                        description: 'Portas de um carro (2,3,4,5) que será usado no cadastro de anúncio'
                        items:
                          type: integer
                      eixos:
                        description: Eixos de caminhão que será usado no cadastro de anúncio
                        type: array
                        items:
                          type: string
                          description: Eixos de caminhão
                      optionals:
                        description: ID do opcional do anúncio (que será usado no cadastro de anúncio)
                        type: array
                        items:
                          $ref: '#/components/schemas/Optional'
                      years:
                        description: Ano para utilizar na pesquisa da fipe
                        type: array
                        items:
                          anyOf:
                            - type: integer
                            - type: string
                      sellers:
                        description: ID dos vendedores da sua loja que será usado no cadastro de anúncio
                        type: array
                        items:
                          $ref: '#/components/schemas/Seller'
components:
  schemas:
    Brand:
      type: object
      description: Marca de um carro
      properties:
        id:
          type: integer
          description: ID da marca
        name:
          type: string
          description: Nome da marca
        type:
          type: integer
          description: Tipo do carro
    Car:
      type: object
      description: Dados para um novo carro
      properties:
        user_id:
          type: integer
          description: 'Código do vendedor, obtido no endpoint populate'
        color_id:
          type: integer
          description: Código da Cor
        doors:
          type: integer
          description: Quantidade de portas (padrão 4)
        eixos:
          type: string
          description: Informação referente aos eixos (exclusivo para caminhões)
        brand_id:
          type: integer
          description: Código da marca
        fipe_id:
          type: integer
          description: Código da tabela Fipe
        year:
          type: integer
          description: Ano de fabricação do veículo
        observation:
          type: string
          description: Observações
        cost:
          type: number
          description: Preço de custo do carro
        price:
          type: number
          description: Valor do carro
        km:
          type: integer
          description: Quilometragem do carro
        optionals:
          description: Opcionais do carro
          type: array
          items:
            type: integer
      required:
        - user_id
        - color_id
        - brand_id
        - fipe_id
        - year
        - observation
        - price
        - km
        - optionals
    CarEvaluation:
      type: object
      description: Avaliação do veículo
      properties:
        id:
          type: integer
          description: Id do veículo
        store_id:
          type: integer
          description: Código da Loja
        rating_id:
          type: integer
          description: Id da avaliação
        rating_link:
          type: string
          description: Link para o PDF da avaliação
        plate:
          type: string
          description: Placa do veículo
        client:
          type: object
          description: Dados do cliente
          properties:
            id:
              type: integer
            name:
              type: string
            phone:
              type: string
        name:
          type: string
          description: Nome do veículo
        model:
          type: string
          description: Modelo do veículo
        year:
          type: integer
          description: Ano do modelo do veículo
        rating_value:
          type: string
          description: Valor da avaliação
        rating_expense_price:
          type: float
          description: Total de despesas da avaliação
        fipe_price:
          type: float
          description: Valor FIPE do veículo
        created_at:
          type: timestamp
          description: Data de criação da avaliação
        brand:
          type: string
          description: Marca do veículo avaliado
        status:
          type: string
          description: Status do anúncio
        published:
          type: boolean
          description: Informa se o veículo foi publicado como anúncio na plataforma
        images:
          type: object
          properties:
            cover:
              type: string
              description: Imagem inicial da avaliação
            gallery:
              type: array
              items:
                type: object
                properties:
                  filename:
                    type: string
                  photo_order:
                    type: integer
                  url:
                    type: string
        photos:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              filename:
                type: string
              photo_order:
                type: integer
                nullable: true
    CarImageResponse:
      type: object
      description: Imagem de um anúncio
      properties:
        id:
          type: integer
          description: ID da imagem
        filename:
          type: string
          description: Nome do arquivo físico
        photo_order:
          type: integer
          description: Ordem da imagem no anúncio
    CarResponse:
      description: Carro / Anúncio
      type: object
      properties:
        id:
          type: integer
          description: ID do anúncio
        user_id:
          type: integer
          description: ID do anunciante
        color_id:
          type: integer
          description: ID da cor do carro
        brand_id:
          type: integer
          description: ID da marca
        fipe_id:
          type: integer
          description: Código FIPE do carro (da tabela interna não da fipe)
        car_status_id:
          type: integer
          description: 'Status do carro (1 em aberto, 2 negociando, 3 vendido, 4 em cadastro)'
        doors:
          type: integer
          description: Quantidade de portas
        status:
          type: string
          description: Status (não utilizar)
        year:
          type: integer
          description: Ano de fabricação do veículo
        observation:
          type: string
          description: Campo observações do anúncio
        price:
          type: number
          description: Valor do carro (mudar para decimal)
        km:
          type: integer
          description: Quilometragem do carro
        created_at:
          type: string
          description: Data/hora de criação do anúncio
        published_at:
          type: string
          description: Data de Publicação do Anúncio
        published_to:
          type: array
          items:
            type: integer
        visible_to:
          type: array
          items:
            $ref: '#/components/schemas/UserTypeResponse'
        user:
          $ref: '#/components/schemas/UserResponse'
        color:
          $ref: '#/components/schemas/Color'
        brand:
          $ref: '#/components/schemas/Brand'
        fipe:
          $ref: '#/components/schemas/Fipe'
        car_status:
          $ref: '#/components/schemas/CarStatusResponse'
        car_negotiations:
          type: integer
          description: Quantidade de negociações do carro
        image:
          type: string
          description: Uma imagem do veículo
        photos:
          type: array
          items:
            $ref: '#/components/schemas/CarImageResponse'
        optionals:
          type: array
          items:
            $ref: '#/components/schemas/Optional'
        is_favorite:
          type: boolean
          description: Retorna se o veículo é favorito
        fipe_percent_off:
          type: string
          description: Percentual do veículo abaixo da tabela fipe
        site_url:
          type: string
          format: uri
          description: Site do cliente (para usuários do plano com site)
    CarStatusResponse:
      type: object
      description: Status de um carro
      properties:
        id:
          type: integer
          description: ID do status (1 em aberto 2 negociando 3 vendido 4 em cadastro)
        name:
          type: string
          description: Nome do status
    Color:
      type: object
      description: Cores de um carro
      properties:
        id:
          type: integer
          description: ID da cor (que será usado no cadastro de anúncio)
        name:
          type: string
          description: Nome da cor
    EditCar:
      type: object
      description: Dados para um editar um carro
      properties:
        color_id:
          type: integer
          description: Código da Cor
        doors:
          type: integer
          description: Quantidade de portas (padrão 4)
        eixos:
          type: string
          description: Informação referente aos eixos (exclusivo para caminhões)
        observation:
          type: string
          description: Observações
        cost:
          type: number
          description: Preço de custo do carro
        price:
          type: number
          description: Valor do carro
        km:
          type: integer
          description: Quilometragem do carro
        optionals:
          description: Opcionais do carro
          type: array
          items:
            type: integer
      required:
        - color_id
        - observation
        - price
        - km
        - optionals
    Fipe:
      type: object
      description: Dados da fipe de um anúncio
      properties:
        id:
          type: integer
          description: ID da fipe (que será usado no cadastro de anúncio)
        modelo_id:
          type: integer
          description: Código do modelo
        brand_id:
          type: integer
          description: ID da marca
        year:
          type: string
          description: Ano do modelo
        fuel:
          type: string
          description: Combustível do modelo
        code:
          type: string
          description: 'Código da Fipe, o mesmo apresentado no site da Fipe'
        price:
          type: number
          description: Valor atual do veículo na tabela fipe
        type:
          type: string
          description: 'Tipo de veículo (0=carro, 5=caminhão, 8=moto)'
    Modelo:
      type: object
      description: Objeto com o tipo de carro
      properties:
        id:
          type: integer
          description: Id do modelo
        name:
          type: string
          description: Nome do modelo
        car_type:
          type: integer
          description: Tipo do veículo
        brand_id:
          type: integer
          description: Id da marca
    Optional:
      type: object
      description: Opcional de um carro
      properties:
        id:
          type: integer
          description: ID do opcional do anúncio (que será usado no cadastro de anúncio)
        name:
          type: string
          description: Nome do item Opcional
        description:
          type: string
          description: Descrição do item opcional
        type:
          type: integer
          description: Tipo do veículo
    OrderResponse:
      description: Tipos de ordenação possíveis
      type: object
      properties:
        label:
          type: string
          description: Nome da ordenação
          example: Ordenação original
        value:
          type: object
          properties:
            order_by:
              type: string
              description: Valor que vai ser enviado para ordenação na requisição
              example: year
              enum:
                - null
                - year
                - price
                - km
            direction:
              type: string
              description: Direção da ordenação
              example: desc
              enum:
                - null
                - asc
                - desc
    RemoveCar:
      type: object
      description: Dados para remover um carro da plataforma
      properties:
        reason_id:
          type: integer
          enum:
            - 1
            - 2
            - 3
          description: Motivo da exclusão 1- Vendido pela plataforma 2- Vendido fora da plataforma 3- Somente excluir
        buyer_id:
          type: integer
          description: Para anúncios excluídos motivo 1 você pode informar a id do comprador
      required:
        - reason_id
    Seller:
      type: object
      description: Dados de um vendedor
      properties:
        id:
          type: integer
          description: ID do vendedor
        name:
          type: string
          description: Nome do vendedor
    UserResponse:
      type: object
      description: Dados do usuário
      properties:
        id:
          type: integer
          description: ID do usuário
        role_id:
          type: string
          description: Role ID do usuário (nível de aceso)
        name:
          type: string
          description: Nome
        email:
          type: string
          description: Email
        dealership:
          type: string
          description: Nome da loja
        document:
          type: string
          description: CPF/CNPJ
        zipcode:
          type: string
          description: CEP
        address:
          type: string
          description: Endereço
        number:
          type: string
          description: Número
        neighborhood:
          type: string
          description: Bairro
        city:
          type: string
          description: Cidade
        state:
          type: string
          description: Estado (UF)
        phone:
          type: string
          description: Telefone
        cell_phone:
          type: string
          description: Telefone Celular
        photo:
          type: string
          description: Endereço público da foto enviada pelo usuário
        latitude:
          type: string
          description: Localização do aparelho celualar (latitude)
        longitude:
          type: string
          description: Localização do aparelho celualar (longitude)
        device_token:
          type: string
          description: Token para enviar notificações ao usuário
        created_at:
          type: string
          description: Data de criação
        is_aprovado:
          type: string
          description: Status do usuário (0 bloqueado 1 aprovado)
        type:
          $ref: '#/components/schemas/UserTypeResponse'
    UserTypeResponse:
      type: object
      description: Objeto do tipo de usuário
      properties:
        id:
          type: integer
          description: Código do usuário
        name:
          type: string
          description: Nome do tipo do usuário
  securitySchemes:
    api_key:
      type: apiKey
      in: header
      name: Api-Key
